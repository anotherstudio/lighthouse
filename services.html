<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<meta name="description" content="" />
		<meta property="og:site_name" content="Lighthouse" />
		<meta property="og:type" content="website" />
		<meta property="og:url" content="https://lighthouseco.in" />
		<meta property="og:image" content="" />
		<meta property="og:image:width" content="2400" />
		<meta property="og:image:height" content="1260" />
		<meta property="og:title" content="" />
		<meta property="og:description" content="" />

		<title></title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap"
			rel="stylesheet"
		/>
		<link
			rel="apple-touch-icon"
			sizes="180x180"
			href="apple-touch-icon.png"
		/>
		<link
			id="favicon"
			rel="icon"
			type="image/png"
			sizes="32x32"
			href="favicon-32x32--dark.png"
		/>

		<link rel="manifest" href="site.webmanifest" />
		<link rel="stylesheet" type="text/css" href="styles.css" />
		<script>
			function loadHTML(url, elementId, callback) {
				fetch(url)
					.then((response) => response.text())
					.then((data) => {
						const element = document.getElementById(elementId);
						element.innerHTML = data;

						// Execute any scripts found in the loaded HTML
						const scripts = element.getElementsByTagName("script");
						for (let i = 0; i < scripts.length; i++) {
							eval(scripts[i].innerText);
						}

						if (callback) callback();
					})
					.catch((error) =>
						console.log("Error loading HTML: ", error)
					);
			}

			document.addEventListener("DOMContentLoaded", function () {
				loadHTML("nav.html", "nav-placeholder");
				loadHTML("footer.html", "footer-placeholder");
			});
		</script>
	</head>

	<body>
		<header class="site-header spacing-x">
			<nav id="nav-placeholder" class="mw-container mx-auto w-100" />
		</header>

		<section class="line-block spacing-x spacing-y h-100vh">
			<div class="grid mw-container mx-auto relative h-100">
				<div class="line line-1"></div>
				<div class="line line-2"></div>
				<div class="line line-3"></div>
				<div class="line line-4"></div>
			</div>
		</section>

		<section class="hero-block spacing-x spacing-b--md bg-purple relative">
			<div class="grid gutter-x mw-container mx-auto relative">
				<h1 class="heading--page col col-12 mb-lg"></h1>
				<div class="heading--block col col-4"></div>
				<div class="heading--block col col-4"></div>
			</div>
			<div class="hero__eyebrows grid gutter-x mw-container mx-auto">
				<div class="col-4 hero__eyebrow"></div>
				<div class="col-4 hero__eyebrow"></div>
				<div class="col-4 hero__eyebrow"></div>
			</div>
		</section>

		<section class="services-block">
			<div class="services-container mw-container mx-auto">
				<div class="services list-reset"></div>
			</div>
		</section>

		<footer id="footer-placeholder" class="site-footer spacing-x" />

		<script src="detect-incognito.js"></script>
		<script>
			// Check if the user has a dark theme enabled or is in incognito mode
			detectIncognito().then((result) => {
				if (result.isPrivate === true) {
					// Light mode
					document.getElementById("favicon").href =
						"favicon-32x32--light.png";
				}
			});

			if (
				window.matchMedia &&
				window.matchMedia("(prefers-color-scheme: dark)").matches
			) {
				// Light mode
				document.getElementById("favicon").href =
					"favicon-32x32--light.png";
			} else {
				// Dark mode
				document.getElementById("favicon").href =
					"favicon-32x32--dark.png";
			}
		</script>

		<script>
			const apiUrl =
				"https://lighthouse-strapi-cms.jxe8y0.easypanel.host";
			const authToken =
				"Bearer f83b08d3aefbfa313bb074e1f69f8884981f819d779a118a41b81120aa41db455b868afe96418ecaa2cc7cb7709db29edebb7dae190fbc7e7554706254935b2f34f2ad2b80d54b47f4a9e2718546ccec224e892034349ac2557c5cb5ebe308baf7dcbe8c6e377dd6dcc3d34ed4132c2418c9277006bccc68d2211d823760234f";
			const endpoint = "services-page";
			const populatedData =
				"?populate=seo,seo.metaImage,heroFull,services";

			fetch(`${apiUrl}/api/${endpoint}${populatedData}`, {
				headers: {
					Authorization: authToken,
				},
			})
				.then((response) => {
					if (!response.ok) {
						throw new Error(
							`HTTP error! Status: ${response.status}`
						);
					}
					return response.json();
				})
				.then((responseJson) => {
					const data = responseJson.data.attributes;

					// Update <title>
					document.title =
						data.seo.pageTitle || "Services â€¢ Lighthouse";

					// Update <meta> description
					const metaDescriptionTag = document.querySelector(
						'meta[name="description"]'
					);
					metaDescriptionTag.setAttribute(
						"content",
						data.seo.metaDescription || ""
					);

					// Update Open Graph tags
					const ogTitleTag = document.querySelector(
						'meta[property="og:title"]'
					);
					ogTitleTag.setAttribute(
						"content",
						data.seo.metaTitle || ""
					);

					const ogDescriptionTag = document.querySelector(
						'meta[property="og:description"]'
					);
					ogDescriptionTag.setAttribute(
						"content",
						data.seo.metaDescription || ""
					);

					const ogImageTag = document.querySelector(
						'meta[property="og:image"]'
					);
					ogImageTag.setAttribute(
						"content",
						data.seo.metaImage.data?.attributes.url
							? `${apiUrl}${data.seo.metaImage.data.attributes.url}`
							: ""
					);

					// Update heroFull section
					const heroTitleElement = document.querySelector(
						".hero-block .heading--page"
					);
					heroTitleElement.textContent = data.heroFull.title || "";

					const firstHeadingElement = document.querySelector(
						".hero-block .heading--block:nth-child(2)"
					);
					firstHeadingElement.textContent =
						data.heroFull.firstHeading || "";

					const secondHeadingElement = document.querySelector(
						".hero-block .heading--block:nth-child(3)"
					);
					secondHeadingElement.textContent =
						data.heroFull.secondHeading || "";

					const firstEyebrowElement = document.querySelector(
						".hero__eyebrows .hero__eyebrow:nth-child(1)"
					);
					firstEyebrowElement.textContent =
						data.heroFull.firstEyebrow || "";

					const secondEyebrowElement = document.querySelector(
						".hero__eyebrows .hero__eyebrow:nth-child(2)"
					);
					secondEyebrowElement.textContent =
						data.heroFull.secondEyebrow || "";

					const thirdEyebrowElement = document.querySelector(
						".hero__eyebrows .hero__eyebrow:nth-child(3)"
					);
					thirdEyebrowElement.textContent =
						data.heroFull.thirdEyebrow || "";

					// Update services section
					const servicesContainer =
						document.querySelector(".services");

					// Clear existing content
					servicesContainer.innerHTML = "";

					// Loop through services data and create HTML elements
					data.services.forEach((service, index) => {
						const serviceButton = document.createElement("button");
						serviceButton.id = service.title
							.toLowerCase()
							.replace(/ /g, "-");
						serviceButton.classList.add("service");

						if (index === 0) {
							serviceButton.classList.add("is-open");
						}

						const serviceTitle = document.createElement("div");
						serviceTitle.classList.add("service__title");
						serviceTitle.textContent =
							service.title || "Default Service Title";
						serviceButton.appendChild(serviceTitle);

						const serviceBody = document.createElement("div");
						serviceBody.classList.add("service__body");

						const wysiwygContent = document.createElement("div");
						wysiwygContent.classList.add("wysiwyg");

						// Handling description which could be an array or string
						if (Array.isArray(service.description)) {
							service.description.forEach((item) => {
								if (item.type === "paragraph") {
									const paragraph =
										document.createElement("p");
									paragraph.textContent = item.children
										.map((child) => child.text)
										.join("");
									wysiwygContent.appendChild(paragraph);
								} else if (item.type === "list") {
									const ul = document.createElement("ul");
									ul.classList.add("list-reset");
									item.children.forEach((listItem) => {
										const li = document.createElement("li");
										li.textContent = listItem.children
											.map((child) => child.text)
											.join("");
										ul.appendChild(li);
									});
									wysiwygContent.appendChild(ul);
								}
							});
						} else if (typeof service.description === "string") {
							const paragraph = document.createElement("p");
							paragraph.textContent = service.description;
							wysiwygContent.appendChild(paragraph);
						}

						serviceBody.appendChild(wysiwygContent);
						serviceButton.appendChild(serviceBody);

						servicesContainer.appendChild(serviceButton);
					});

					// After dynamically creating the buttons, call handleServiceClick to attach event listeners
					handleServiceClick();
				})
				.catch((error) => {
					console.error("Error fetching data:", error);
				});
		</script>

		<script>
			// Function to calculate and store service-open width
			function calculateServiceOpenWidth() {
				const containerWidth = document.querySelector(
					".services-container"
				).offsetWidth;
				window.serviceOpenWidth = containerWidth - 800;
			}

			// Function to handle click on .service elements
			function handleServiceClick() {
				const services = document.querySelectorAll(".service");

				services.forEach((service) => {
					service.addEventListener("click", function () {
						const isOpen = this.classList.toggle("is-open");

						services.forEach((s) => {
							if (s !== this) {
								s.classList.remove("is-open");
								s.style.width = ""; // Reset other services
							}
						});

						if (isOpen) {
							this.style.width = window.serviceOpenWidth + "px";
							// Update hash in URL
							const serviceId = this.getAttribute("id");
							if (serviceId) {
								window.location.hash = serviceId;
							}
							// Scroll horizontally to the selected service
							this.scrollIntoView({
								behavior: "smooth",
								block: "nearest",
								inline: "start",
							});
						} else {
							this.style.width = ""; // Close the opened service
							// Remove hash from URL
							history.replaceState(null, null, " ");
						}
					});
				});
			}

			// Function to handle window resize
			function handleWindowResize() {
				calculateServiceOpenWidth();
				const openService = document.querySelector(".service.is-open");
				if (openService) {
					openService.style.width = window.serviceOpenWidth + "px";
				}
			}

			// Function to expand accordion based on the hash
			async function expandAccordionFromHash() {
				const hash = window.location.hash.slice(1); // Remove the '#' from the hash

				if (hash) {
					const selector = `#${hash}`;
					try {
						const targetElement = await waitForElement(
							selector,
							10000
						); // Wait for 10 seconds

						document
							.querySelectorAll(".service")
							.forEach((service) => {
								if (service !== targetElement) {
									service.classList.remove("is-open");
									service.style.width = "";
								}
							});

						targetElement.classList.add("is-open");
						targetElement.style.width =
							window.serviceOpenWidth + "px";

						targetElement.scrollIntoView({
							behavior: "smooth",
							block: "start",
							inline: "nearest",
						});
					} catch (error) {
						console.error("Error expanding accordion:", error);
					}
				}
			}

			// Function to check if an element with specified selector exists in the DOM
			function elementExists(selector) {
				return document.querySelector(selector) !== null;
			}

			// Function to wait for an element to be loaded based on a selector
			function waitForElement(selector, timeout) {
				return new Promise((resolve, reject) => {
					const startTime = Date.now();
					const checkInterval = setInterval(() => {
						if (elementExists(selector)) {
							clearInterval(checkInterval);
							resolve(document.querySelector(selector));
						} else if (Date.now() - startTime > timeout) {
							clearInterval(checkInterval);
							reject(
								new Error(
									`Timeout waiting for element with selector ${selector}`
								)
							);
						}
					}, 100); // Poll every 100ms
				});
			}

			// Function to initialize everything
			function initializeAccordion() {
				calculateServiceOpenWidth();
				handleServiceClick();
				handleWindowResize();
				expandAccordionFromHash();

				window.addEventListener("resize", handleWindowResize);
				window.addEventListener("hashchange", expandAccordionFromHash);

				// Check if hash is present on initial load
				if (window.location.hash) {
					expandAccordionFromHash();
				}
			}

			// Wait for the DOM content to load before initializing
			document.addEventListener("DOMContentLoaded", initializeAccordion);
		</script>
	</body>
</html>
