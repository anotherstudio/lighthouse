<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<meta name="description" content="" />
		<meta property="og:site_name" content="Lighthouse" />
		<meta property="og:type" content="website" />
		<meta property="og:url" content="https://lighthouseco.in" />
		<meta property="og:image" content="" />
		<meta property="og:image:width" content="2400" />
		<meta property="og:image:height" content="1260" />
		<meta property="og:title" content="" />
		<meta property="og:description" content="" />

		<title></title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&display=swap"
			rel="stylesheet"
		/>
		<link
			rel="apple-touch-icon"
			sizes="180x180"
			href="apple-touch-icon.png"
		/>
		<link
			id="favicon"
			rel="icon"
			type="image/png"
			sizes="32x32"
			href="favicon-32x32--dark.png"
		/>

		<link rel="manifest" href="site.webmanifest" />
		<link rel="stylesheet" type="text/css" href="styles.css" />
		<script>
			function loadHTML(url, elementId, callback) {
				fetch(url)
					.then((response) => response.text())
					.then((data) => {
						const element = document.getElementById(elementId);
						element.innerHTML = data;

						// Execute any scripts found in the loaded HTML
						const scripts = element.getElementsByTagName("script");
						for (let i = 0; i < scripts.length; i++) {
							eval(scripts[i].innerText);
						}

						if (callback) callback();
					})
					.catch((error) =>
						console.log("Error loading HTML: ", error)
					);
			}

			document.addEventListener("DOMContentLoaded", function () {
				loadHTML("nav.html", "nav-placeholder");
				loadHTML("footer.html", "footer-placeholder");
			});
		</script>
	</head>

	<body>
		<header class="site-header spacing-x">
			<nav id="nav-placeholder" class="mw-container mx-auto w-100" />
		</header>

		<section class="line-block spacing-x spacing-y h-100vh">
			<div class="grid mw-container mx-auto relative h-100">
				<div class="line line-1"></div>
				<div class="line line-2"></div>
				<div class="line line-3"></div>
				<div class="line line-4"></div>
			</div>
		</section>

		<section class="hero-block spacing-x spacing-b--md bg-orange relative">
			<div class="grid gutter-x mw-container mx-auto relative w-100">
				<h1 class="heading--page col col-12"></h1>
			</div>
			<div class="hero__eyebrows grid gutter-x mw-container mx-auto">
				<div class="col col-6 hero__eyebrow"></div>
			</div>
		</section>

		<div class="relative s-hidden">
			<figure class="about-intro__image w-100 image-bg relative">
				<img loading="lazy" class="object-fit" src="" alt="" />
			</figure>
		</div>

		<section class="about-intro-block spacing-x spacing-y--section">
			<div
				class="about-intro__grid grid gutter-x mw-container mx-auto relative"
			>
				<div class="about-intro__text col">
					<div class="heading--block"></div>
					<div class="heading--description mt-md"></div>
				</div>
				<div class="relative s-visible">
					<figure class="about-intro__image image-bg relative">
						<img loading="lazy" class="object-fit" src="" alt="" />
					</figure>
				</div>
			</div>
		</section>

		<section class="values-block spacing-x spacing-y--section bg-blue">
			<div class="grid gutter-x mw-container mx-auto relative">
				<div class="col col-4 pr-sm">
					<div class="heading--eyebrow"></div>
					<div class="values__title pr-lg"></div>
				</div>
				<div class="col col-4 pr-sm">
					<div class="heading--eyebrow l-visible"></div>
					<div class="values__title pr-lg"></div>
				</div>
				<div class="col col-4 pr-sm">
					<div class="heading--eyebrow l-visible"></div>
					<div class="values__title pr-lg"></div>
				</div>
				<div class="values__divider col"></div>
				<div class="col col-4 pr-sm">
					<div class="heading--block"></div>
				</div>
				<div class="col col-8 pr-sm">
					<div class="heading--block"></div>
				</div>
			</div>
		</section>

		<section class="testimonials-block relative">
			<ul class="testimonials list-reset"></ul>

			<div class="testimonials-controls spacing-x w-100 l-visible">
				<div
					class="testimonials-controls__inner mw-container mx-auto w-100"
				>
					<button class="testimonials-controls--prev">
						<svg
							width="19"
							height="32"
							viewBox="0 0 19 32"
							fill="none"
							xmlns="http://www.w3.org/2000/svg"
						>
							<path
								d="M17.1426 2L3.00044 16.1421L17.1426 30.2843"
								stroke="currentColor"
								stroke-width="4"
							/>
						</svg>
					</button>
					<button class="testimonials-controls--next">
						<svg
							width="20"
							height="32"
							viewBox="0 0 20 32"
							fill="none"
							xmlns="http://www.w3.org/2000/svg"
						>
							<path
								d="M2.14258 2L16.2847 16.1421L2.14258 30.2843"
								stroke="currentColor"
								stroke-width="4"
							/>
						</svg>
					</button>
				</div>
			</div>
			<div class="dots-container"></div>
		</section>

		<section class="clients-block spacing-y--section spacing-x">
			<div class="grid gutter-x mw-container mx-auto relative">
				<h2 class="col col-12 heading--section mb-lg"></h2>
				<div class="col col-12 clients__container"></div>
			</div>
		</section>

		<section class="team-block mx-auto spacing-x spacing-y--section">
			<div class="mw-container relative l-hidden mb-lg">
				<div class="w-100 mb-lg">
					<h2 class="heading--section"></h2>
				</div>
			</div>
			<div class="team__grid mw-container mx-auto relative">
				<div class="col col-4 w-100 l-visible">
					<h2 class="heading--section"></h2>
				</div>
			</div>
		</section>

		<footer id="footer-placeholder" class="site-footer spacing-x" />

		<script src="detect-incognito.js"></script>
		<script>
			// Check if the user has a dark theme enabled or is in incognito mode
			detectIncognito().then((result) => {
				if (result.isPrivate === true) {
					// Light mode
					document.getElementById("favicon").href =
						"favicon-32x32--light.png";
				}
			});

			if (
				window.matchMedia &&
				window.matchMedia("(prefers-color-scheme: dark)").matches
			) {
				// Light mode
				document.getElementById("favicon").href =
					"favicon-32x32--light.png";
			} else {
				// Dark mode
				document.getElementById("favicon").href =
					"favicon-32x32--dark.png";
			}
		</script>
		<script>
			const apiUrl =
				"https://lighthouse-strapi-cms.jxe8y0.easypanel.host";
			const authToken =
				"Bearer f83b08d3aefbfa313bb074e1f69f8884981f819d779a118a41b81120aa41db455b868afe96418ecaa2cc7cb7709db29edebb7dae190fbc7e7554706254935b2f34f2ad2b80d54b47f4a9e2718546ccec224e892034349ac2557c5cb5ebe308baf7dcbe8c6e377dd6dcc3d34ed4132c2418c9277006bccc68d2211d823760234f";
			const endpoint = "about-page";
			const populatedData =
				"?populate=seo,seo.metaImage,heroTiny,about,about.image,values,testimonials,clients,clients.clientLogo.logo,team,team.teamMember.profileImage,team.teamMember.modalImageFull";

			fetch(`${apiUrl}/api/${endpoint}${populatedData}`, {
				headers: {
					Authorization: authToken,
				},
			})
				.then((response) => {
					if (!response.ok) {
						throw new Error(
							`HTTP error! Status: ${response.status}`
						);
					}
					return response.json();
				})
				.then((responseJson) => {
					const data = responseJson.data.attributes;

					// Update <title>
					document.title = data.seo.pageTitle || "Lighthouse - About";

					// Update <meta> description
					const metaDescriptionTag = document.querySelector(
						'meta[name="description"]'
					);
					metaDescriptionTag.setAttribute(
						"content",
						data.seo.metaDescription || ""
					);

					// Update Open Graph tags
					const ogTitleTag = document.querySelector(
						'meta[property="og:title"]'
					);
					ogTitleTag.setAttribute(
						"content",
						data.seo.metaTitle || ""
					);

					const ogDescriptionTag = document.querySelector(
						'meta[property="og:description"]'
					);
					ogDescriptionTag.setAttribute(
						"content",
						data.seo.metaDescription || ""
					);

					const ogImageTag = document.querySelector(
						'meta[property="og:image"]'
					);
					ogImageTag.setAttribute(
						"content",
						data.seo.metaImage.data?.attributes.url
							? `${apiUrl}${data.seo.metaImage.data.attributes.url}`
							: ""
					);

					// Update hero section
					// Hero title
					const heroTitleElement = document.querySelector(
						".hero-block .heading--page"
					);
					heroTitleElement.textContent = data.heroTiny.title || "";

					// Hero eyebrow
					const eyebrowElement = document.querySelector(
						".hero__eyebrows .hero__eyebrow:nth-child(1)"
					);
					eyebrowElement.textContent = data.heroTiny.eyebrow || "";

					// Update about section
					// Select all <img> elements that need to be updated
					const aboutImageElements = document.querySelectorAll(
						".about-intro__image img, .another-image img"
					);

					// Loop through each img element
					aboutImageElements.forEach((aboutImageElemen) => {
						// Update src and alt attributes
						aboutImageElemen.src = `${apiUrl}${data.about.image.data.attributes.url}`;
						aboutImageElemen.alt = data.about.imageAlternativeText;
					});

					// Update heading
					const headingBlock = document.querySelector(
						".about-intro-block .about-intro__text .heading--block"
					);
					headingBlock.textContent = data.about.title;

					// Update description
					const descriptionBlock = document.querySelector(
						".about-intro-block .about-intro__text .heading--description"
					);
					descriptionBlock.textContent = data.about.description;

					// Update values section
					const valuesBlock = document.querySelector(".values-block");

					// Update the first set of values
					valuesBlock.querySelectorAll(
						".heading--eyebrow"
					)[0].textContent = data.values.firstEyebrow;
					valuesBlock.querySelectorAll(
						".values__title"
					)[0].textContent = data.values.firstValueTitle;

					// Update the second set of values
					valuesBlock.querySelectorAll(
						".heading--eyebrow"
					)[1].textContent = data.values.secondEyebrow;
					valuesBlock.querySelectorAll(
						".values__title"
					)[1].textContent = data.values.secondValueTitle;

					// Update the third set of values
					valuesBlock.querySelectorAll(
						".heading--eyebrow"
					)[2].textContent = data.values.thirdEyebrow;
					valuesBlock.querySelectorAll(
						".values__title"
					)[2].textContent = data.values.thirdValueTitle;

					// Update the main heading
					valuesBlock.querySelector(
						".values__divider + .col .heading--block"
					).textContent = data.values.heading;

					// Update the description
					valuesBlock.querySelector(
						".col.col-8.pr-sm .heading--block"
					).textContent = data.values.description;

					// Update testimonials section
					// Function to shuffle an array
					function shuffleArray(array) {
						for (let i = array.length - 1; i > 0; i--) {
							const j = Math.floor(Math.random() * (i + 1));
							[array[i], array[j]] = [array[j], array[i]];
						}
						return array;
					}

					// Select the parent ul element
					const testimonialsList = document.querySelector(
						".testimonials-block .testimonials"
					);

					// Function to create a new testimonial item
					function createTestimonialItem(testimonial) {
						// Create the li element
						const li = document.createElement("li");
						li.className = "testimonial spacing-x relative";

						// Create the inner structure
						li.innerHTML = `
						<div class="mw-container mx-auto spacing-x">
								<img
										loading="lazy"
										class="testimonial__icon mb-md"
										src="assets/images/quotemarks.svg"
										alt="Quotemarks"
								/>
								<div class="testimonial__text heading--block">
										${testimonial.quote}
								</div>
								<div class="testimonial__meta mt-lg">
										<p class="testimonial__person"><strong>${testimonial.person}</strong></p>
										<p class="testimonial__business">${testimonial.company}</p>
								</div>
						</div>
				`;

						return li;
					}

					// Shuffle the testimonials data
					const shuffledTestimonials = shuffleArray(
						data.testimonials
					);

					// Iterate over the shuffled data and add each testimonial to the list
					shuffledTestimonials.forEach((testimonial) => {
						const newTestimonialItem =
							createTestimonialItem(testimonial);
						testimonialsList.appendChild(newTestimonialItem);
					});

					// Initialize carousel functionality
					function initCarousel() {
						const testimonialsContainer =
							document.querySelector(".testimonials");
						const dotsContainer =
							document.querySelector(".dots-container");
						const slides =
							document.querySelectorAll(".testimonial");
						const slideWidth = testimonialsContainer.offsetWidth;

						function scrollToNextSlide() {
							const currentSlideIndex = getCurrentSlideIndex();
							const nextIndex =
								(currentSlideIndex + 1) % slides.length;
							scrollToSlide(nextIndex);
						}

						function scrollToPrevSlide() {
							const currentSlideIndex = getCurrentSlideIndex();
							const prevIndex =
								(currentSlideIndex - 1 + slides.length) %
								slides.length;
							scrollToSlide(prevIndex);
						}

						function scrollToSlide(index) {
							const scrollDestination = index * slideWidth;
							testimonialsContainer.scrollTo({
								left: scrollDestination,
								behavior: "smooth",
							});
							setTimeout(() => setActiveDot(index), 500); // Delay to prevent double blink
						}

						function getCurrentSlideIndex() {
							return Math.round(
								testimonialsContainer.scrollLeft / slideWidth
							);
						}

						function setActiveDot(index) {
							const dots = document.querySelectorAll(".dot");
							dots.forEach((dot, i) => {
								if (i === index) {
									dot.classList.add("active");
								} else {
									dot.classList.remove("active");
								}
							});
						}

						// Clear existing dots
						dotsContainer.innerHTML = "";

						slides.forEach((slide, index) => {
							const dot = document.createElement("button");
							dot.classList.add("dot");
							dot.setAttribute("tabindex", "0");
							if (index === 0) {
								dot.classList.add("active");
							}
							dot.addEventListener("click", () => {
								scrollToSlide(index);
							});
							dot.addEventListener("keydown", (event) => {
								if (
									event.key === "Enter" ||
									event.key === " "
								) {
									scrollToSlide(index);
								} else if (event.key === "ArrowRight") {
									scrollToNextSlide();
								} else if (event.key === "ArrowLeft") {
									scrollToPrevSlide();
								}
							});
							dotsContainer.appendChild(dot);
						});

						testimonialsContainer.addEventListener("scroll", () => {
							const currentSlideIndex = getCurrentSlideIndex();
							setActiveDot(currentSlideIndex);
						});

						const prevButton = document.querySelector(
							".testimonials-controls--prev"
						);
						const nextButton = document.querySelector(
							".testimonials-controls--next"
						);

						prevButton.addEventListener("click", scrollToPrevSlide);
						nextButton.addEventListener("click", scrollToNextSlide);

						let pos = { top: 0, left: 0, x: 0, y: 0 };

						const mouseDownHandler = function (e) {
							testimonialsContainer.style.cursor = "grabbing";
							testimonialsContainer.style.userSelect = "none";

							pos = {
								left: testimonialsContainer.scrollLeft,
								top: testimonialsContainer.scrollTop,
								// Get the current mouse position
								x: e.clientX,
								y: e.clientY,
							};

							document.addEventListener(
								"mousemove",
								mouseMoveHandler
							);
							document.addEventListener(
								"mouseup",
								mouseUpHandler
							);
						};

						const mouseMoveHandler = function (e) {
							const sensitivityFactor = 2;

							// How far the mouse has been moved
							const dx = (e.clientX - pos.x) * sensitivityFactor;
							const dy = e.clientY - pos.y;

							// Scroll the element
							testimonialsContainer.scrollTop = pos.top - dy;
							testimonialsContainer.scrollLeft = pos.left - dx;
						};

						const mouseUpHandler = function () {
							testimonialsContainer.style.cursor = "grab";
							testimonialsContainer.style.removeProperty("user-select");

							document.removeEventListener(
								"mousemove",
								mouseMoveHandler
							);
							document.removeEventListener(
								"mouseup",
								mouseUpHandler
							);
						};

						// Attach the handler
						testimonialsContainer.addEventListener("mousedown", mouseDownHandler);
					}

					// Call the initCarousel function to initialize the carousel
					initCarousel();

					// Update Our Clients section
					const clientsHeadingElement = document.querySelector(
						".clients-block .heading--section"
					);
					clientsHeadingElement.textContent = data.clients.title;

					// Select the parent container for client logos
					const clientsContainer = document.querySelector(
						".clients-block .clients__container"
					);

					// Function to create a new client logo item
					function createClientLogoItem(client) {
						// Create the div element
						const div = document.createElement("div");
						div.className = "clients__logo";

						// Create the inner structure
						div.innerHTML = `
							<img
									loading="lazy"
									src="${apiUrl}${client.logo.data.attributes.url}"
									alt="${client.alternativeText}"
							/>
					`;

						return div;
					}

					// Iterate over each client logo to the container)
					data.clients.clientLogo.forEach((client) => {
						const newClientLogoItem = createClientLogoItem(client);
						clientsContainer.appendChild(newClientLogoItem);
					});

					// Update Our Team section
					// Select the heading elements and update their text content
					const teamHeadingElements = document.querySelectorAll(
						".team-block .heading--section"
					);
					teamHeadingElements.forEach((heading) => {
						heading.textContent = data.team.title;
					});

					// Select the parent container for team members
					const teamGrid = document.querySelector(
						".team-block .team__grid"
					);

					// Function to create a new team member item
					function createTeamMemberItem(member, modalIndex) {
						// Create the team member column
						const col = document.createElement("div");
						col.className = "team-member__col";

						// Create the inner button structure
						col.innerHTML = `
            <button class="team-member open-modal" data-modal="modal-${modalIndex}">
                <figure class="relative aspect-ratio--1x1 image-bg">
                    <img
                        loading="lazy"
                        class="object-fit"
                        src="${apiUrl}${member.profileImage.data.attributes.url}"
                        alt="${member.profileImageAlternativeText}"
                    />
                </figure>
                <p class="team-member__title heading--block">
                    ${member.name}
                </p>
            </button>
        `;

						return col;
					}

					// Function to create a new modal item
					function createModalItem(member, modalIndex) {
						// Create the modal
						const modal = document.createElement("div");
						modal.id = `modal-${modalIndex}`;
						modal.className = "modal";

						// Create the inner modal structure
						modal.innerHTML = `
            <div class="modal-content spacing-x">
                <div class="modal-content__grid grid gutter-x mw-container mx-auto relative">
                    <div class="modal-content__eyebrow heading--eyebrow l-visible">
                        Meet the team
                    </div>
                    <button class="close">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect y="2.82837" width="4" height="40" transform="rotate(-45 0 2.82837)" fill="black"/>
                            <rect x="2.82812" y="31.1128" width="4" height="40" transform="rotate(-135 2.82812 31.1128)" fill="black"/>
                        </svg>
                    </button>
                    <div class="col col-4">
                        <figure class="modal-content__image relative aspect-ratio--3x4 image-bg">
                            <img
                                loading="lazy"
                                class="object-fit"
                                src="${apiUrl}${member.modalImageFull.data.attributes.url}"
                                alt="${member.modalImageAlternativeText}"
                            />
                        </figure>
                    </div>
                    <div class="col col-8">
                        <div class="modal-content__body">
                            <h3 class="modal-content__title heading--section mb-md word-per-line">
                                ${member.name}
                            </h3>
                            <div class="wysiwyg">
                                <p>
                                    ${member.modalDescription}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;

						return modal;
					}

					// Iterate over the CMS data and add each team member and modal to the container
					data.team.teamMember.forEach((member, index) => {
						const modalIndex = index + 1;
						const newTeamMemberItem = createTeamMemberItem(
							member,
							modalIndex
						);
						teamGrid.appendChild(newTeamMemberItem);

						const newModalItem = createModalItem(
							member,
							modalIndex
						);
						document
							.querySelector(".team-block")
							.appendChild(newModalItem);
					});

					// Modal functionality
					function addModalFunctionality() {
						// Get all elements that open modals
						const openModalButtons =
							document.querySelectorAll(".open-modal");

						// Get all modal elements
						const modals = document.querySelectorAll(".modal");

						// Get all close buttons
						const closeButtons =
							document.querySelectorAll(".close");

						// Function to open modal with transition
						function openModal(modalId) {
							const modal = document.getElementById(modalId);
							modal.classList.add("visible"); // Ensure the modal is displayed
							setTimeout(() => {
								modal.classList.add("show"); // Start the opacity transition
								const closeButton =
									modal.querySelector(".close");
								closeButton.focus(); // Set focus to the close button
							}, 10); // Small delay to allow display change to take effect
						}

						// Function to close modal with transition
						function closeModal(modal) {
							modal.classList.remove("show"); // Start the opacity transition
							setTimeout(() => {
								modal.classList.remove("visible"); // Hide the modal after the transition
								const openModalButton = document.querySelector(
									`[data-modal="${modal.id}"]`
								);
								openModalButton.focus(); // Set focus back to the open button
							}, 300); // Delay must match the CSS transition duration
						}

						// Add click event to each open modal button
						openModalButtons.forEach((button) => {
							button.addEventListener("click", () => {
								const modalId =
									button.getAttribute("data-modal");
								openModal(modalId);
							});
						});

						// Add click event to each close button
						closeButtons.forEach((button) => {
							button.addEventListener("click", () => {
								const modal = button.closest(".modal");
								closeModal(modal);
							});
						});

						// Add click event to window to close modal when clicking outside of modal-content
						window.addEventListener("click", (event) => {
							modals.forEach((modal) => {
								if (event.target === modal) {
									closeModal(modal);
								}
							});
						});
					}

					// Call the function to add modal functionality
					addModalFunctionality();
				})
				.catch((error) => {
					console.error("Error fetching data:", error);
				});
		</script>
	</body>
</html>
